import requests
from defusedxml.ElementTree import fromstring
import logging
import json
from pythonjsonlogger import jsonlogger
import xml.sanitizer

url = 'http://localhost/xml'
shellcode = '''<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [
  <!ELEMENT foo ANY>
  <!ENTITY xxe SYSTEM
  "file:///etc/passwd">
]>
<foo>
  &xxe;
</foo>
'''

# Sanitize the input to prevent XXE attacks
sanitizer = xml.sanitizer.make_document_sanitizer()
clean_shellcode = sanitizer.sanitize(shellcode)

# Structure the log message and data
log_message = "Processing input"
log_data = {"input": clean_shellcode}

# Set up logging
logger = logging.getLogger(__name__)
logHandler = logging.StreamHandler()
formatter = jsonlogger.JsonFormatter()
logHandler.setFormatter(formatter)
logger.addHandler(logHandler)

# Log the structured data
logger.info(json.dumps({"message": log_message, **log_data}))

data = {'input_data': clean_shellcode}

response = requests.post(url, data=data)

print(response.text)























































































































































































